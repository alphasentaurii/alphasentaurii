<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Predicting Home Values</title><!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Predicting Home Values" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Ask any realtor what are the top 3 most important variables for measuring property value, and they will all say the same thing: 1) location, 2) location, and 3) location. I asked a friend who has been doing real estate for about 20 years (we’ll call her “Mom”) what other factors besides location tend to have some impact and she mentioned the following:" />
<meta property="og:description" content="Ask any realtor what are the top 3 most important variables for measuring property value, and they will all say the same thing: 1) location, 2) location, and 3) location. I asked a friend who has been doing real estate for about 20 years (we’ll call her “Mom”) what other factors besides location tend to have some impact and she mentioned the following:" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-11-06T10:23:47-08:00" />
<script type="application/ld+json">
{"headline":"Predicting Home Values","dateModified":"2019-11-06T10:23:47-08:00","datePublished":"2019-11-06T10:23:47-08:00","@type":"BlogPosting","url":"/datascience/2019/11/06/predicting-home-values-with-multiple-linear-regression.html","mainEntityOfPage":{"@type":"WebPage","@id":"/datascience/2019/11/06/predicting-home-values-with-multiple-linear-regression.html"},"description":"Ask any realtor what are the top 3 most important variables for measuring property value, and they will all say the same thing: 1) location, 2) location, and 3) location. I asked a friend who has been doing real estate for about 20 years (we’ll call her “Mom”) what other factors besides location tend to have some impact and she mentioned the following:","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<html>
<head>

<style>
*{
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}



body {
background-color: #000;
/*background-image:url(./back.png);*/
background-size:cover; 
/*background-size: 1920px 1165px;*/
background-repeat: no-repeat;
background-position: top; 
background-attachment:fixed;
line-height:1.4em;
overflow:auto;
margin:0px;
padding:0px;
}

body:before {
  content: "";
  position: relative;
  top: 0px;
  left: 50%;
  bottom: 0px;
  transform: translateX(-50%);
  width: 4px;
}

canvas {
width:99%;
height:99%;
background-color: transparent;
position: fixed;
clear:both;
z-index: 10;
}


.centered {
/*
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
*/
margin:100px auto;
z-index: 9999;
width:100%;
max-width:1485px;
height:auto;
}

img a {
border:none;
}

.logo {
width:100%;
max-width:1485px;
margin:0 auto;
border:none;
}

.button {
position:relative;
border: 1px solid #000;
background: #00111c;
background: #3b3b3b;
padding: 12.5px 25px;
color: #ccc;
font-size:25px;

text-decoration: none;
vertical-align: middle;
z-index:9999;
min-width:300px;
}
.button:hover {
background: #001f33;
color: #fff;
}
.button:active {
background: #000000;
}

@media only screen and (max-width: 600px) {
	.button {
	font-size:15px;
	}
}


body .entries {
position:relative;
top:10px;
width: calc(100% - 80px);
max-width: 1000px;
margin: auto;
left: -5px;

}
body .entries .entry {
  width: calc(50% - 70px);
  float: left;
  padding: 20px;
  clear: both;
  text-align: right;
}
body .entries .entry:not(:first-child) {
  margin-top: -60px;
}
body .entries .entry .title {

  margin-bottom: 12px;
  position: relative;
  color: #fff;
}
body .entries .entry .title:before {
  content: "";
  position: absolute;
  width: 8px;
  height: 8px;
  border: 4px solid #fff;
  background-color: #1d1d1d;
  border-radius: 100%;
  top: 50%;
  transform: translateY(-50%);
  right: -73px;
  z-index: 1000;
}
body .entries .entry .title.big:before {
  width: 24px;
  height: 24px;
  transform: translate(8px, -50%);
}
body .entries .entry .body {
  color: #aaa;
}
body .entries .entry .body p {
  line-height: 1.4em;
}
body .entries .entry:nth-child(2n) {
  text-align: left;
  float: right;
}
body .entries .entry:nth-child(2n) .title:before {
  left: -63px;
}
body .entries .entry:nth-child(2n) .title.big:before {
  transform: translate(-8px, -50%);
}

.grid {
width:100%;
display: -webkit-flex; /* Safari */
display: flex;
padding:10px 60px;
flex-wrap: wrap;
}

.col-quarter {
-webkit-flex: 1;  /* Safari 6.1+ */
-ms-flex: 1;  /* IE 10 */    
flex: 1;
margin:10px 80px;
flex-wrap: wrap;
}

.responsive-img {
max-width: 100%; 
display:block; 
height: auto;
min-width:200px;
}

#footer {
display:block;
position:relative;
z-index:9999;
background: #111;
text-align:center;
margin:0px;

}


</style>
</head>
<body>
<script>
    var canvas = document.getElementById('nokey'),
        can_w = parseInt(canvas.getAttribute('width')),
        can_h = parseInt(canvas.getAttribute('height')),
        ctx = canvas.getContext('2d');
    
    // console.log(typeof can_w);
    
    var ball = {
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            r: 0,
            alpha: 1,
            phase: 0
        },
        ball_color = {
            r: 207,
            g: 255,
            b: 4
        },
        R = 2,
        balls = [],
        alpha_f = 0.03,
        alpha_phase = 0,
        
    // Line
        link_line_width = 0.8,
        dis_limit = 260,
        add_mouse_point = true,
        mouse_in = false,
        mouse_ball = {
            x: 0,
            y: 0,
            vx: 0,
            vy: 0,
            r: 0,
            type: 'mouse'
        };
    
    // Random speed
    function getRandomSpeed(pos){
        var  min = -1,
            max = 1;
        switch(pos){
            case 'top':
                return [randomNumFrom(min, max), randomNumFrom(0.1, max)];
                break;
            case 'right':
                return [randomNumFrom(min, -0.1), randomNumFrom(min, max)];
                break;
            case 'bottom':
                return [randomNumFrom(min, max), randomNumFrom(min, -0.1)];
                break;
            case 'left':
                return [randomNumFrom(0.1, max), randomNumFrom(min, max)];
                break;
            default:
                return;
                break;
        }
    }
    function randomArrayItem(arr){
        return arr[Math.floor(Math.random() * arr.length)];
    }
    function randomNumFrom(min, max){
        return Math.random()*(max - min) + min;
    }
    console.log(randomNumFrom(0, 10));
    // Random Ball
    function getRandomBall(){
        var pos = randomArrayItem(['top', 'right', 'bottom', 'left']);
        switch(pos){
            case 'top':
                return {
                    x: randomSidePos(can_w),
                    y: -R,
                    vx: getRandomSpeed('top')[0],
                    vy: getRandomSpeed('top')[1],
                    r: R,
                    alpha: 1,
                    phase: randomNumFrom(0, 10)
                }
                break;
            case 'right':
                return {
                    x: can_w + R,
                    y: randomSidePos(can_h),
                    vx: getRandomSpeed('right')[0],
                    vy: getRandomSpeed('right')[1],
                    r: R,
                    alpha: 1,
                    phase: randomNumFrom(0, 10)
                }
                break;
            case 'bottom':
                return {
                    x: randomSidePos(can_w),
                    y: can_h + R,
                    vx: getRandomSpeed('bottom')[0],
                    vy: getRandomSpeed('bottom')[1],
                    r: R,
                    alpha: 1,
                    phase: randomNumFrom(0, 10)
                }
                break;
            case 'left':
                return {
                    x: -R,
                    y: randomSidePos(can_h),
                    vx: getRandomSpeed('left')[0],
                    vy: getRandomSpeed('left')[1],
                    r: R,
                    alpha: 1,
                    phase: randomNumFrom(0, 10)
                }
                break;
        }
    }
    function randomSidePos(length){
        return Math.ceil(Math.random() * length);
    }
    
    // Draw Ball
    function renderBalls(){
        Array.prototype.forEach.call(balls, function(b){
            if(!b.hasOwnProperty('type')){
                ctx.fillStyle = 'rgba('+ball_color.r+','+ball_color.g+','+ball_color.b+','+b.alpha+')';
                ctx.beginPath();
                ctx.arc(b.x, b.y, R, 0, Math.PI*2, true);
                ctx.closePath();
                ctx.fill();
            }
        });
    }
    
    // Update balls
    function updateBalls(){
        var new_balls = [];
        Array.prototype.forEach.call(balls, function(b){
            b.x += b.vx;
            b.y += b.vy;
            
            if(b.x > -(50) && b.x < (can_w+50) && b.y > -(50) && b.y < (can_h+50)){
                new_balls.push(b);
            }
            
            // alpha change
            b.phase += alpha_f;
            b.alpha = Math.abs(Math.cos(b.phase));
            // console.log(b.alpha);
        });
        
        balls = new_balls.slice(0);
    }
    
    // loop alpha
    function loopAlphaInf(){
        
    }
    
    // Draw lines
    function renderLines(){
        var fraction, alpha;
        for (var i = 0; i < balls.length; i++) {
            for (var j = i + 1; j < balls.length; j++) {
                
                fraction = getDisOf(balls[i], balls[j]) / dis_limit;
                
                if(fraction < 1){
                    alpha = (1 - fraction).toString();
    
                    ctx.strokeStyle = 'rgba(150,150,150,'+alpha+')';
                    ctx.lineWidth = link_line_width;
                    
                    ctx.beginPath();
                    ctx.moveTo(balls[i].x, balls[i].y);
                    ctx.lineTo(balls[j].x, balls[j].y);
                    ctx.stroke();
                    ctx.closePath();
                }
            }
        }
    }
    
    // calculate distance between two points
    function getDisOf(b1, b2){
        var  delta_x = Math.abs(b1.x - b2.x),
            delta_y = Math.abs(b1.y - b2.y);
        
        return Math.sqrt(delta_x*delta_x + delta_y*delta_y);
    }
    
    // add balls if there a little balls
    function addBallIfy(){
        if(balls.length < 20){
            balls.push(getRandomBall());
        }
    }
    
    // Render
    function render(){
        ctx.clearRect(0, 0, can_w, can_h);
        
        renderBalls();
        
        renderLines();
        
        updateBalls();
        
        addBallIfy();
        
        window.requestAnimationFrame(render);
    }
    
    // Init Balls
    function initBalls(num){
        for(var i = 1; i <= num; i++){
            balls.push({
                x: randomSidePos(can_w),
                y: randomSidePos(can_h),
                vx: getRandomSpeed('top')[0],
                vy: getRandomSpeed('top')[1],
                r: R,
                alpha: 1,
                phase: randomNumFrom(0, 10)
            });
        }
    }
    // Init Canvas
    function initCanvas(){
        canvas.setAttribute('width', window.innerWidth);
        canvas.setAttribute('height', window.innerHeight);
        
        can_w = parseInt(canvas.getAttribute('width'));
        can_h = parseInt(canvas.getAttribute('height'));
    }
    window.addEventListener('resize', function(e){
        console.log('Window Resize...');
        initCanvas();
    });
    
    function goMovie(){
        initCanvas();
        initBalls(20);
        window.requestAnimationFrame(render);
    }
    goMovie();
    
    // Mouse effect
    canvas.addEventListener('mouseenter', function(){
        console.log('mouseenter');
        mouse_in = true;
        balls.push(mouse_ball);
    });
    canvas.addEventListener('mouseleave', function(){
        console.log('mouseleave');
        mouse_in = false;
        var new_balls = [];
        Array.prototype.forEach.call(balls, function(b){
            if(!b.hasOwnProperty('type')){
                new_balls.push(b);
            }
        });
        balls = new_balls.slice(0);
    });
    canvas.addEventListener('mousemove', function(e){
        var e = e || window.event;
        mouse_ball.x = e.pageX;
        mouse_ball.y = e.pageY;
        // console.log(mouse_ball);
    });
    </script>
</body>
</html><link rel="stylesheet" type="text/css" href="/assets/main-kali.css"></head>
<body>
    
    <div class="container"><header>
  <div class="menu">
    <ul></ul>

  </div>
</header>
<nav>
<a href="/">home</a>
<a href="/about.html">about</a>
<a href="/blog.html">blog</a>
<a href="/projects.html">projects</a>
</nav>

        
    <main style="z-index: 99; position: relative;">

      <small>6 November 2019</small>
<h1>Predicting Home Values</h1>

<p class="view">by Ru Kein</p>

<p>Ask any realtor what are the top 3 most important variables for measuring property value, and they will all say the same thing: 1) location, 2) location, and 3) location. I asked a friend who has been doing real estate for about 20 years (we’ll call her “Mom”) what other factors besides location tend to have some impact and she mentioned the following:</p>

<ol>
  <li>Square-footage</li>
  <li>Condition</li>
  <li>Number of Bathrooms</li>
  <li>Market Demand</li>
  <li>Geography</li>
  <li>The Buyer</li>
</ol>

<h3 id="1-square-footage">1. Square-Footage</h3>

<p>Almost every time, a bigger house is going to cost more than a smaller one.</p>

<h3 id="2-condition">2. Condition</h3>

<p>Condition of the house: “Is it a fixer-upper?”</p>

<h3 id="3-number-of-bathrooms">3. Number of Bathrooms</h3>

<p>She specifically said number of bathrooms outweighs number of bedrooms: “although sometimes more bathrooms will mean more bedrooms, that’s not always the case”. This project is going to tell us mathematically if her assumptions are valid or not.</p>

<h2 id="market-demand">Market Demand</h2>

<p>Mom also mentioned how market demand changes from generation to generation. For example, right now (Nov 2019) more and more ‘millenials’ are buying houses, but unlike their parents who might be more inclined toward buying a property with a lot of land sitting farther away from the city, millenials generally want the opposite. They want to be close to the hustle and bustle, they want “fixer-uppers” they can buy at a lower price and spend their money making it their own.</p>

<h2 id="geographic-differences">Geographic Differences</h2>

<p>The selling-factors for real estate in one town are not necessarily going to hold true for a town on the other side of the country. In other words, we can’t automatically assume the predictors we identify in this dataset are universal.</p>

<h2 id="the-client">The Client</h2>
<p>When it comes to real estate, or selling anything for that matter, it’s absolutely critical to keep in mind what is going on in the market, what your target demographic is, and most of all, what do they want? For this project, the client is someone who “flips” houses and is looking to buy property in the Greater Seattle area. Our job is to help them identify which factors are most important to consider before they purchase a house for flipping (i.e. reselling for a higher price).</p>

<h1 id="property-values-by-zip-code">Property Values by Zip Code</h1>

<div style="background-color:white">
<img src="/assets/images/king-county/tableau-map-kingcounty.png" alt="tableau zip codes and price" title="Map of Zip Codes and Price in Tableau" width="400" />
</div>

<h2 id="goal">Goal</h2>

<p>The goal was to identify a strategy for increasing the sale price or property value of a given home in this location. To achieve the above goal, I used a <code class="highlighter-rouge">multiple linear regression model</code> to identify the best combination of variables for predicting the <code class="highlighter-rouge">target</code>: price of a home at the time of sale.</p>

<h2 id="dataset">Dataset</h2>

<p>The dataset is comprised of over 20,000 home sales between May 2014 - May 2015. In addition to the price at time of sale, each observation (or row) was associated with 18 dependent variables (or <code class="highlighter-rouge">features</code>). For my analysis, I was interested in identifying <strong>which combination of variables</strong> are the best predictors of high property values. Hence the term <em>multiple</em> linear regression (a simple linear regression model would inaccurately only account for one factor.</p>

<h2 id="features">Features</h2>

<p>The model eliminated most of these features, leaving me with just 3: square footage of the home’s living area, the graded score of the property, and the zip code as well as latitude and longitude where the property was located.</p>

<ul>
  <li>id</li>
  <li>date</li>
  <li>price</li>
  <li>waterfront</li>
  <li>view</li>
  <li>yr_built</li>
  <li>yr_renovated</li>
  <li>condition</li>
  <li>grade</li>
  <li>zipcode</li>
  <li>lat</li>
  <li>long</li>
  <li>bedrooms</li>
  <li>bathrooms</li>
  <li>floors</li>
  <li>sqft_above</li>
  <li>sqft_basement</li>
  <li>sqft_living</li>
  <li>sqft_lot</li>
  <li>sqft_living15</li>
  <li>sqft_lot15</li>
</ul>

<h2 id="top-3-features">Top 3 Features</h2>

<p>Let’s take a closer look at these “top 3” features.</p>

<h3 id="1-square-footage-living-area">1. Square-footage (Living area)</h3>

<p>This includes the square footage of the basement, but excludes square footage of the land around the home. Not surprisingly, it turns out that homes with a higher square footage of living space tend to have much higher property values. The bigger the house, the higher the sale price. You can see from the scatter plot below that as the property values increase upward, the square-footage also increases to the right.</p>

<h4 id="square-foot-living-and-price-scatterplot">Square-Foot Living and Price (Scatterplot)</h4>

<div style="background-color:white">
<img src="/assets/images/king-county/sqft-living-scatterplot.png" alt="sqft living scatterplot" title="Sqft Living Scatterplot" width="400" />
</div>

<h3 id="2-grade">2. Grade</h3>

<p>Next, I looked at something called <code class="highlighter-rouge">GRADE</code>. Each property in the dataset is associated with a score ranging from 1 to 13, 13 being the best. The factors that actually determine that score have to do with the quality of materials in the home, the wood, marble, etc., as well as the quality of carpentry and craftsmanship put into those materials. Much like the scatterplot we saw before, the box plot (below) shows how higher scores in Grade lead to higher property values.</p>

<h4 id="grade-boxplot-increases-with-price">Grade (Boxplot) Increases with Price</h4>

<div style="background-color:white">
<img src="/assets/images/king-county/grade-boxplot.png" alt="grade boxplot" title="Grade Boxplot" width="400" />
</div>

<h4 id="high-grade-scores-less-common">High Grade Scores Less Common</h4>

<p>In the plot below, it’s also noticeable that there are far fewer homes that achieve a grade of 13, indicating these homes might be unique in some way, perhaps the architect is well-known, or the materials themselves are rare, all of which factors into the overall grade of the property regardless of how many bedrooms or square-footage of the land, etc.</p>

<h4 id="distribution-of-grade-scatterplot">Distribution of Grade (scatterplot)</h4>

<div style="background-color:white">
<img src="/assets/images/king-county/grade-scatterplot.png" alt="grade scatterplot" title="Grade Scatterplot" width="400" /></div>

<h4 id="3-location-location-location">3. Location, Location, Location</h4>

<p>Now, don’t take it just from me - if you ask any realtor what are the three most important factors for selling your home at the highest possible value, they’ll all say the same thing: Location, Location, and Location. What I can tell you is that this is in fact mathematically true, according the model: median home values increase or decrease depending on the <code class="highlighter-rouge">zip code</code>.</p>

<h3 id="3-location--grade-">3. Location + Grade ?</h3>

<p>I was curious whether there is any relationship between Grade and Location, so I created this plot by mapping each home’s latitude and longitude, then I applied a color scheme to see if certain grades happen to fall in any kind of geographic pattern. Sure enough, you can see that the pink and purple dots, which are the highest grade scores, are far fewer, and they tend to clump around a specific area, which just so happens to be - Seattle - a city known for its prime real estate. However, according the model, you need to have a higher grade as well as a specific location in order to capture te highest possible price. In other words, both features are critical and you can’t simply increase the price of a home simply by having one feature without the other. You need both.</p>

<h4 id="latitude-and-longitude-geographic-distribution-of-grade">Latitude and Longitude: Geographic Distribution of Grade</h4>

<div style="background-color:white">
<img src="/assets/images/king-county/grade-lat-long.png" alt="grade lat long" title="Grade and Location" width="400" />
</div>

<h4 id="median-home-values-by-zip-code">Median Home Values by Zip Code</h4>

<p>So just to show you how that breaks down, below is a map of King County where the lines indicate the zip code boundaries. The lighter shades of purple indicate lower property values, whereas the darkest shades of purple represent the highest property values. The darkest one on here is, of course, Seattle.</p>

<h4 id="interactive-map">Interactive Map</h4>

<html>
<div style="max-width:600px">
<iframe src="https://public.tableau.com/views/HousePricesbyZipCodeinKingCountyWA/KingCounty?:display_count=y&amp;publish=yes&amp;:origin=viz_share_link" width="600" height="600" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>
</div>
</html>

<h4 id="look-up-median-home-values-by-zip-code">Look Up Median Home Values by Zip Code</h4>

<p>Now let’s say you want to know which zip codes fall under a given range of home values. Maybe you only want to consider zip codes where the median value is $1,000,000 or higher. So I wrote a function for doing just that, and for King County, the million dollar question gives us only one zip code, 98039, and if we drop it down to say half a million for median home values, we get back 14 zip codes to choose from.</p>

<h1 id="conclusion">Conclusion</h1>

<p>According to our final model, the best predictors of house prices are sqft-living, zipcode, and grade.  What’s really important to keep in mind is that the model eliminated 15 possible variables from having a significant impact on price - so what that means is if you have a home in one of these zip codes, it doesn’t matter so much how many bedrooms or bathrooms you have, the mere fact that your property is in one of these zip codes automatically increases the property value. Beyond that, the only factors for increasing the home’s value that you need to focus on would be the grade and the square footage of the living space.</p>

<h2 id="summary">Summary</h2>

<p>So to recap, increasing the price of your home comes down to three critical factors: the square footage of the living area, the grade (materials and craftsmanship), and the location (zip code). <strong>Location is so important that no matter how much money you invest in building a bigger house, even with the most expensive and rare materials and a fancy architect, if it’s not a “desirable” location, in this case, too far outside Seattle, you’re not going to sell the house for the kind of price you’d otherwise get closer to the city.</strong></p>

<h2 id="recommendations">Recommendations</h2>

<ol>
  <li>Homes with larger living areas are valued higher than smaller homes.</li>
  <li>Houses in certain zip codes are valued at higher prices than other zip codes.</li>
  <li>Homes that score above at least 8 on Grade will sell higher than those below.</li>
</ol>

<h2 id="future-work">Future Work</h2>

<h3 id="1-do-house-prices-change-over-time-or-depending-on-season">1. Do house prices change over time or depending on season?</h3>

<p>This data set was limited to a one-year time-frame. I’d be interested in widening the sample size to investigate how property values fluctuate over time as well as how they are affected by market fluctuations.</p>

<h3 id="2-resold-homes">2. Resold Homes</h3>

<p>Can we validate the accuracy of our prediction model by looking specifically at houses that resold for a higher price in a given timeframe? In other words, try to identify which specific variables changed (e.g. increased grade score after doing renovations) and therefore were determining factors in the increased price of the home when it was resold.</p>

<h2 id="code">CODE</h2>

<p><a href="https://github.com/hakkeray/predicting-home-values-with-multiple-linear-regression">github repo</a></p>

<h2 id="contact">CONTACT</h2>

<p><a href="mailto:rukeine@gmail.com">rukeine@gmail.com</a></p>

<h2 id="license">LICENSE</h2>

<p><a href="/LICENSE.html">MIT License</a></p>



  <small>tags: <em>real-estate</em></small>

<link rel="stylesheet" type="text/css" href="/assets/kali.css">

<canvas id="nokey">
    Your Browser Doesn't Support Canvas, Please Download Chrome or compatible browser.
</canvas>


<script>
var canvas = document.getElementById('nokey'),
    can_w = parseInt(canvas.getAttribute('width')),
    can_h = parseInt(canvas.getAttribute('height')),
    ctx = canvas.getContext('2d');

// console.log(typeof can_w);

var ball = {
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        r: 0,
        alpha: 1,
        phase: 0
    },
    ball_color = {
        r: 207,
        g: 255,
        b: 4
    },
    R = 2,
    balls = [],
    alpha_f = 0.03,
    alpha_phase = 0,
    
// Line
    link_line_width = 0.8,
    dis_limit = 260,
    add_mouse_point = true,
    mouse_in = false,
    mouse_ball = {
        x: 0,
        y: 0,
        vx: 0,
        vy: 0,
        r: 0,
        type: 'mouse'
    };

// Random speed
function getRandomSpeed(pos){
    var  min = -1,
        max = 1;
    switch(pos){
        case 'top':
            return [randomNumFrom(min, max), randomNumFrom(0.1, max)];
            break;
        case 'right':
            return [randomNumFrom(min, -0.1), randomNumFrom(min, max)];
            break;
        case 'bottom':
            return [randomNumFrom(min, max), randomNumFrom(min, -0.1)];
            break;
        case 'left':
            return [randomNumFrom(0.1, max), randomNumFrom(min, max)];
            break;
        default:
            return;
            break;
    }
}
function randomArrayItem(arr){
    return arr[Math.floor(Math.random() * arr.length)];
}
function randomNumFrom(min, max){
    return Math.random()*(max - min) + min;
}
console.log(randomNumFrom(0, 10));
// Random Ball
function getRandomBall(){
    var pos = randomArrayItem(['top', 'right', 'bottom', 'left']);
    switch(pos){
        case 'top':
            return {
                x: randomSidePos(can_w),
                y: -R,
                vx: getRandomSpeed('top')[0],
                vy: getRandomSpeed('top')[1],
                r: R,
                alpha: 1,
                phase: randomNumFrom(0, 10)
            }
            break;
        case 'right':
            return {
                x: can_w + R,
                y: randomSidePos(can_h),
                vx: getRandomSpeed('right')[0],
                vy: getRandomSpeed('right')[1],
                r: R,
                alpha: 1,
                phase: randomNumFrom(0, 10)
            }
            break;
        case 'bottom':
            return {
                x: randomSidePos(can_w),
                y: can_h + R,
                vx: getRandomSpeed('bottom')[0],
                vy: getRandomSpeed('bottom')[1],
                r: R,
                alpha: 1,
                phase: randomNumFrom(0, 10)
            }
            break;
        case 'left':
            return {
                x: -R,
                y: randomSidePos(can_h),
                vx: getRandomSpeed('left')[0],
                vy: getRandomSpeed('left')[1],
                r: R,
                alpha: 1,
                phase: randomNumFrom(0, 10)
            }
            break;
    }
}
function randomSidePos(length){
    return Math.ceil(Math.random() * length);
}

// Draw Ball
function renderBalls(){
    Array.prototype.forEach.call(balls, function(b){
        if(!b.hasOwnProperty('type')){
            ctx.fillStyle = 'rgba('+ball_color.r+','+ball_color.g+','+ball_color.b+','+b.alpha+')';
            ctx.beginPath();
            ctx.arc(b.x, b.y, R, 0, Math.PI*2, true);
            ctx.closePath();
            ctx.fill();
        }
    });
}

// Update balls
function updateBalls(){
    var new_balls = [];
    Array.prototype.forEach.call(balls, function(b){
        b.x += b.vx;
        b.y += b.vy;
        
        if(b.x > -(50) && b.x < (can_w+50) && b.y > -(50) && b.y < (can_h+50)){
            new_balls.push(b);
        }
        
        // alpha change
        b.phase += alpha_f;
        b.alpha = Math.abs(Math.cos(b.phase));
        // console.log(b.alpha);
    });
    
    balls = new_balls.slice(0);
}

// loop alpha
function loopAlphaInf(){
    
}

// Draw lines
function renderLines(){
    var fraction, alpha;
    for (var i = 0; i < balls.length; i++) {
        for (var j = i + 1; j < balls.length; j++) {
            
            fraction = getDisOf(balls[i], balls[j]) / dis_limit;
            
            if(fraction < 1){
                alpha = (1 - fraction).toString();

                ctx.strokeStyle = 'rgba(150,150,150,'+alpha+')';
                ctx.lineWidth = link_line_width;
                
                ctx.beginPath();
                ctx.moveTo(balls[i].x, balls[i].y);
                ctx.lineTo(balls[j].x, balls[j].y);
                ctx.stroke();
                ctx.closePath();
            }
        }
    }
}

// calculate distance between two points
function getDisOf(b1, b2){
    var  delta_x = Math.abs(b1.x - b2.x),
        delta_y = Math.abs(b1.y - b2.y);
    
    return Math.sqrt(delta_x*delta_x + delta_y*delta_y);
}

// add balls if there a little balls
function addBallIfy(){
    if(balls.length < 20){
        balls.push(getRandomBall());
    }
}

// Render
function render(){
    ctx.clearRect(0, 0, can_w, can_h);
    
    renderBalls();
    
    renderLines();
    
    updateBalls();
    
    addBallIfy();
    
    window.requestAnimationFrame(render);
}

// Init Balls
function initBalls(num){
    for(var i = 1; i <= num; i++){
        balls.push({
            x: randomSidePos(can_w),
            y: randomSidePos(can_h),
            vx: getRandomSpeed('top')[0],
            vy: getRandomSpeed('top')[1],
            r: R,
            alpha: 1,
            phase: randomNumFrom(0, 10)
        });
    }
}
// Init Canvas
function initCanvas(){
    canvas.setAttribute('width', window.innerWidth);
    canvas.setAttribute('height', window.innerHeight);
    
    can_w = parseInt(canvas.getAttribute('width'));
    can_h = parseInt(canvas.getAttribute('height'));
}
window.addEventListener('resize', function(e){
    console.log('Window Resize...');
    initCanvas();
});

function goMovie(){
    initCanvas();
    initBalls(20);
    window.requestAnimationFrame(render);
}
goMovie();

// Mouse effect
canvas.addEventListener('mouseenter', function(){
    console.log('mouseenter');
    mouse_in = true;
    balls.push(mouse_ball);
});
canvas.addEventListener('mouseleave', function(){
    console.log('mouseleave');
    mouse_in = false;
    var new_balls = [];
    Array.prototype.forEach.call(balls, function(b){
        if(!b.hasOwnProperty('type')){
            new_balls.push(b);
        }
    });
    balls = new_balls.slice(0);
});
canvas.addEventListener('mousemove', function(e){
    var e = e || window.event;
    mouse_ball.x = e.pageX;
    mouse_ball.y = e.pageY;
    // console.log(mouse_ball);
});
</script>

</main><footer>
  Copyright (c) 2020 Ru Keïn
</footer>
</div>
    
  </body>
</html>
